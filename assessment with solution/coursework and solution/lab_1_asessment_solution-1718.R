#' ---
#' title: Lab 1 - Coursework solution
#' author: Tom Palmer
#' date: 8th October 2017
#' --- 

# ------------------------------------------------------------------------------
# data input
# ------------------------------------------------------------------------------
trout.age <- c( 1, 1,  1,  1 , 2 , 2 , 2 , 3  ,3  ,3 , 4 
                , 4 , 4 , 5 , 6 , 6 , 6 , 7 , 7
                , 7 , 8 , 8 , 8 , 9, 11, 12, 12, 12)
trout.pcb <- c( 0.6 , 1.6 , 0.5  ,1.2,  2.0 , 1.3 , 2.5 , 
                2.2 , 2.4 , 1.2 , 3.5, 4.1 , 5.1 , 5.7 , 
                3.4,  9.7 , 8.6 , 4.0,  5.5, 10.5, 17.5, 
                13.4, 4.5, 30.4, 12.4, 13.4, 26.2,  7.4)

# ------------------------------------------------------------------------------
# (1) reproduce final plot
# ------------------------------------------------------------------------------
ages <- seq(from=0, to=12, by=0.1)
a <- -2.3907
b <- 2.300
l <- a + b*ages^(1/3)

plot(x=trout.age, y=log(trout.pcb))
points(x=ages, y=l, type="l", col="blue")


# ------------------------------------------------------------------------------
# (2) log(pcb) equation
# ------------------------------------------------------------------------------
calc_log_pcb <- function(a, b, ages) {
  log_pcb = a + b*ages^(1/3)
  return(log_pcb)
}

print(calc_log_pcb)


# ------------------------------------------------------------------------------
# (3) extend age plot 
# ------------------------------------------------------------------------------
ages <- seq(from=0, to=20, by=0.1)
log_pcb <- calc_log_pcb(a=-2.3907, b=2.300, ages=ages)


plot(x=ages, y=log_pcb, type="l", col="blue")


# ------------------------------------------------------------------------------
# (4) maximum expected log(PCB)
# ------------------------------------------------------------------------------
print(max(log_pcb))


# ------------------------------------------------------------------------------
# (5) update the trout model
# ------------------------------------------------------------------------------
# 

# ------------------------------------------------------------------------------
# (a) New log(pcb) equation
# ------------------------------------------------------------------------------
calc_log_pcb2 <- function(a=-4.865, b=4.7016, c=0.1969, ages) {
  log_pcb = a + b*ages^c
  return(log_pcb)
}

print(calc_log_pcb2)

# ------------------------------------------------------------------------------
# (b) Comparison of estimators for 10 year old trout
# ------------------------------------------------------------------------------

print(c("Bates-Watts estimator", 
        calc_log_pcb2(a=-2.3907, b=2.300, c=1/3, ages=10)))

print(c("New estimator", calc_log_pcb2(ages=10)))


# ------------------------------------------------------------------------------
# (c) Comparison of estimators for 10 year old trout
# ------------------------------------------------------------------------------

log_pcb2 = calc_log_pcb2(ages=ages)

# plot using new model data first
plot(x=ages, y=log_pcb2, type="l", col="red", 
     xlab="Age", ylab="log(PCB)")
# then overlay old model data
points(x=ages, y=log_pcb, type="l", col="blue")
legend(x="bottomright", c("New","Bates-Watts"),lty=c(1,1),col=c("red","blue"))
